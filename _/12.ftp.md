# FTP

Информация:

* [http://help.ubuntu.ru/wiki/...](http://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%D1%8B%D0%B5_%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0/ftp_server) 

## Провекра

Узнаем статус служб:

```
$ service --status-all
```

Проверим установлен ли пакер `vsftpd`:

```
$ apt-cache search vsftpd
$ dpkg -s vsftpd | grep Status
```

Проверим существует ли пользователь и группа `ftp`

```
$ cat /etc/passwd | grep ftp
$ cat /etc/group | grep ftp
```

## Cервер vsftpd

### Установка vsftpd

```
$ apt-get install vsftpd

```

### Настройка авторизованного доступа по FTP

Создадим пользователя `ftp_mylinker`


```
$ adduser ftp_mylinker
```

```
$ vi /etc/vsftpd.conf
local_enable=YES
write_enable=YES
```

Перезапустим службу
```
$ service vsftpd restart
```

### sysv-rc-conf

Пакет для управления автозагрузкой служб.

```
$ apt-get install sysv-rc-conf
```

Проверить режимы автозагрузки можно командой:

```
$ sysv-rc-conf --list
```

### Создание ссылки на каталог

* Информация:

http://tftf.ru/stati/linux/sozdat_simvolicheskuyu_ssylku_na_papku_fajl/


Создадим ссылку на нужный нам каталог и открываем доступ:

```
$ ln -s /var/www/mylinker/application/web/theme/resources/product-images /home/ftp_mylinker/product-images
```

### iptables

Информация:

* http://help.ubuntu.ru/wiki/iptables
* http://askubuntu.com/questions/261626/configuration-of-iptables-verfication-actives-services-allow-ftp
* [http://help.ubuntu.ru/wiki...](http://help.ubuntu.ru/wiki/%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE_%D0%BF%D0%BE_ubuntu_server/%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D1%8C/firewall) 
* http://www.linux.org.ru/forum/admin/8195230

Получим список правил:

```
$ iptables -L
$ iptables-save
```

Сохраним текущие правила 

```
$ mkdir /etc/iptables.old
$ cp /etc/iptables/* /etc/iptables.old
```

Разрешим доступ по порту `21`:

```
$ iptables -A INPUT -p tcp --dport 21 -j ACCEPT
$ iptables -A OUTPUT -p tcp --sport 20 -j ACCEPT
```


### Права на доступ к каталогу

```
$ chmod a-w /home/ftp_mylinker/
$ service vsftpd restart
```

### Тестирование доступа на сревере

Протестируем доступ к `ftp` на сервер:

```
$ ftp localhost

```

Проверь что на серваке vsftp биндит внешний интерфейс: 

```
# netstat -ln | grep :21
tcp        0      0 91.200.42.63:21         0.0.0.0:*               LISTEN
```

### Тестирование доступа с локальной машины

Протестируем доступ к `ftp` через локальную машину:

```
$ ftp 188.225.77.86

```